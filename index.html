<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NumberQuest ¬∑ –ú—É–ª—å—Ç–∏–∏–≥—Ä—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: var(--tg-theme-bg-color, #0a0a1a);
            color: var(--tg-theme-text-color, #ffffff);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
        }

        /* –ì–ª–∞–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ */
        .game-hub {
            max-width: 420px;
            width: 100%;
            background: linear-gradient(145deg, var(--tg-theme-secondary-bg-color, #151525), var(--tg-theme-bg-color, #0c0c1a));
            border-radius: 40px;
            padding: 20px 16px;
            box-shadow: 0 25px 50px -8px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 215, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        /* –ê–≤–∞—Ç–∞—Ä–∫–∞ –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.03);
            padding: 10px 16px;
            border-radius: 60px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .avatar {
            width: 44px;
            height: 44px;
            border-radius: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.4rem;
            color: white;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .user-info h3 {
            font-size: 1rem;
            opacity: 0.7;
            font-weight: 400;
        }

        .user-info h2 {
            font-size: 1.3rem;
            font-weight: 700;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .global-stats {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .stat-item {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 24px;
            padding: 14px 5px;
            text-align: center;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .stat-value {
            font-size: 1.6rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ffd700, #ffa500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.7rem;
            opacity: 0.6;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* –í—ã–±–æ—Ä –∏–≥—Ä—ã */
        .game-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding: 4px 2px;
            scrollbar-width: none;
        }

        .game-selector::-webkit-scrollbar {
            display: none;
        }

        .game-tab {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 12px 20px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            transition: all 0.2s;
            color: var(--tg-theme-hint-color, #aaa);
            flex: 1;
            text-align: center;
            cursor: pointer;
        }

        .game-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
            box-shadow: 0 10px 20px -5px rgba(102, 126, 234, 0.5);
        }

        /* –ò–≥—Ä–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ */
        .game-area {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 32px;
            padding: 20px 16px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.03);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .game-title {
            font-size: 1.3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, #ccc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .game-badge {
            background: rgba(255, 215, 0, 0.15);
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å */
        .progress-bar {
            background: rgba(0, 0, 0, 0.4);
            height: 30px;
            border-radius: 20px;
            padding: 3px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #667eea, #764ba2, #ff6b6b);
            border-radius: 20px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ */
        .hint-display {
            background: linear-gradient(135deg, #667eea20, #764ba220);
            border-radius: 30px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hint-main {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .hint-sub {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
        .input-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .game-input {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 16px 20px;
            font-size: 1.2rem;
            color: white;
            font-weight: 600;
            text-align: center;
            outline: none;
        }

        .game-input:focus {
            border-color: #667eea;
        }

        .game-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 30px;
            padding: 0 25px;
            color: white;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 10px 20px -5px #667eea80;
            transition: transform 0.1s;
        }

        .game-btn:active {
            transform: scale(0.95);
        }

        /* –°–µ—Ç–∫–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∏–≥—Ä */
        .mini-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .mini-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 24px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.2s;
        }

        .mini-card:active {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.08);
        }

        .mini-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .mini-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .mini-desc {
            font-size: 0.7rem;
            opacity: 0.5;
        }

        /* –ò—Å—Ç–æ—Ä–∏—è */
        .history-row {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 30px;
            padding: 12px 16px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--tg-theme-hint-color, #888);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.03);
        }
    </style>
</head>
<body>
    <div class="game-hub">
        <!-- –®–∞–ø–∫–∞ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º -->
        <div class="profile-header">
            <div class="avatar" id="userAvatar">üéÆ</div>
            <div class="user-info">
                <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å,</h3>
                <h2 id="userName">–ò–≥—Ä–æ–∫</h2>
            </div>
        </div>

        <!-- –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="global-stats">
            <div class="stat-item">
                <div class="stat-value" id="totalScore">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –æ—á–∫–æ–≤</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="gamesPlayed">0</div>
                <div class="stat-label">–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="winRate">0%</div>
                <div class="stat-label">–ü–æ–±–µ–¥</div>
            </div>
        </div>

        <!-- –¢–∞–±—ã –≤—ã–±–æ—Ä–∞ –∏–≥—Ä—ã -->
        <div class="game-selector" id="gameTabs">
            <div class="game-tab active" data-game="classic">üéØ –ö–ª–∞—Å—Å–∏–∫–∞</div>
            <div class="game-tab" data-game="ranges">üé≤ –î–∏–∞–ø–∞–∑–æ–Ω—ã</div>
            <div class="game-tab" data-game="time">‚ö° –≠–∫—Å—Ç—Ä–∏–º</div>
            <div class="game-tab" data-game="math">üßÆ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</div>
        </div>

        <!-- –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å (–º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏) -->
        <div class="game-area" id="gameArea">
            <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è –∞–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–∞ -->
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø—ã—Ç–æ–∫ -->
        <div class="history-row" id="historyDisplay">
            ‚è≥ –ù–∞—á–Ω–∏ –∏–≥—Ä—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let userName = tg.initDataUnsafe?.user?.first_name || '–ò–≥—Ä–æ–∫';
        let userAvatar = tg.initDataUnsafe?.user?.username?.charAt(0).toUpperCase() || 'üéÆ';
        document.getElementById('userName').innerText = userName;
        document.getElementById('userAvatar').innerText = userAvatar;

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        let totalScore = 0;
        let gamesPlayed = 0;
        let wins = 0;
        let currentGame = 'classic';
        let gameHistory = [];

        // –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏–≥—Ä
        let gameStates = {
            classic: { secret: 42, min: 1, max: 100, attempts: 0, maxAttempts: 7, score: 0, level: 1 },
            ranges: { secret: 50, min: 1, max: 100, attempts: 0, maxAttempts: 8, score: 0, mode: 'easy' },
            time: { secret: 0, min: 1, max: 200, attempts: 0, maxAttempts: 5, score: 0, timeLeft: 30 },
            math: { secret: 0, min: 1, max: 50, attempts: 0, maxAttempts: 6, score: 0, equation: '' }
        };

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateGlobalStats() {
            document.getElementById('totalScore').innerText = totalScore;
            document.getElementById('gamesPlayed').innerText = gamesPlayed;
            let winPercent = gamesPlayed > 0 ? Math.round((wins / gamesPlayed) * 100) : 0;
            document.getElementById('winRate').innerText = winPercent + '%';
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∏–≥—Ä–∞–º–∏
        document.querySelectorAll('.game-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.game-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentGame = tab.dataset.game;
                loadGame(currentGame);
            });
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∏–≥—Ä—ã
        function loadGame(game) {
            let html = '';
            switch(game) {
                case 'classic':
                    html = classicGameHTML();
                    break;
                case 'ranges':
                    html = rangesGameHTML();
                    break;
                case 'time':
                    html = timeGameHTML();
                    break;
                case 'math':
                    html = mathGameHTML();
                    break;
            }
            document.getElementById('gameArea').innerHTML = html;
            attachGameListeners(game);
        }

        // HTML –¥–ª—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∏–≥—Ä—ã
        function classicGameHTML() {
            let state = gameStates.classic;
            return `
                <div class="game-header">
                    <span class="game-title">üéØ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º</span>
                    <span class="game-badge">–≠—Ç–∞–∂ ${state.level}</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${(state.attempts/state.maxAttempts)*100}%">${state.attempts}/${state.maxAttempts}</div>
                </div>
                <div class="hint-display">
                    <div class="hint-main" id="gameHint">${state.secret ? 'üîÆ' : '–ù–∞—á–Ω–∏!'}</div>
                    <div class="hint-sub" id="rangeHint">–æ—Ç ${state.min} –¥–æ ${state.max}</div>
                </div>
                <div class="input-group">
                    <input type="number" id="gameInput" class="game-input" placeholder="–í–≤–µ–¥–∏ —á–∏—Å–ª–æ" min="${state.min}" max="${state.max}">
                    <button class="game-btn" id="submitBtn">‚Üí</button>
                </div>
            `;
        }

        // HTML –¥–ª—è –∏–≥—Ä—ã —Å –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏
        function rangesGameHTML() {
            let state = gameStates.ranges;
            let ranges = [
                { name: 'üå± 1-50', min: 1, max: 50 },
                { name: 'üåø 1-100', min: 1, max: 100 },
                { name: 'üóª 1-500', min: 1, max: 500 },
                { name: 'üöÄ 1-1000', min: 1, max: 1000 }
            ];
            let rangeButtons = ranges.map(r => 
                `<div class="mini-card" data-min="${r.min}" data-max="${r.max}">
                    <div class="mini-icon">${r.name.split(' ')[0]}</div>
                    <div class="mini-title">${r.name.split(' ')[1]}</div>
                </div>`
            ).join('');
            
            return `
                <div class="game-header">
                    <span class="game-title">üé≤ –í—ã–±–µ—Ä–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å</span>
                    <span class="game-badge">–°—á–µ—Ç: ${state.score}</span>
                </div>
                <div class="mini-grid">
                    ${rangeButtons}
                </div>
                <div class="hint-display">
                    <div class="hint-main" id="gameHint">${state.secret || '???'}</div>
                    <div class="hint-sub" id="rangeHint">${state.min}-${state.max}</div>
                </div>
                <div class="input-group">
                    <input type="number" id="gameInput" class="game-input" placeholder="–¢–≤–æ–π –æ—Ç–≤–µ—Ç">
                    <button class="game-btn" id="submitBtn">‚Üí</button>
                </div>
            `;
        }

        // HTML –¥–ª—è —ç–∫—Å—Ç—Ä–∏–º-–∏–≥—Ä—ã
        function timeGameHTML() {
            return `
                <div class="game-header">
                    <span class="game-title">‚ö° –≠–∫—Å—Ç—Ä–∏–º</span>
                    <span class="game-badge" id="timerDisplay">30—Å</span>
                </div>
                <div class="hint-display">
                    <div class="hint-main" id="gameHint">‚è∞</div>
                    <div class="hint-sub">–£–≥–∞–¥–∞–π –∑–∞ 30 —Å–µ–∫—É–Ω–¥!</div>
                </div>
                <div class="input-group">
                    <input type="number" id="gameInput" class="game-input" placeholder="–ß–∏—Å–ª–æ 1-200">
                    <button class="game-btn" id="submitBtn">‚Üí</button>
                </div>
            `;
        }

        // HTML –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–≥—Ä—ã
        function mathGameHTML() {
            return `
                <div class="game-header">
                    <span class="game-title">üßÆ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</span>
                    <span class="game-badge">–†–µ—à–∏ –ø—Ä–∏–º–µ—Ä</span>
                </div>
                <div class="hint-display">
                    <div class="hint-main" id="gameHint">5 + 3 = ?</div>
                    <div class="hint-sub">–í–≤–µ–¥–∏ –æ—Ç–≤–µ—Ç</div>
                </div>
                <div class="input-group">
                    <input type="number" id="gameInput" class="game-input" placeholder="–û—Ç–≤–µ—Ç">
                    <button class="game-btn" id="submitBtn">‚Üí</button>
                </div>
            `;
        }

        // –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫ —Ç–µ–∫—É—â–µ–π –∏–≥—Ä–µ
        function attachGameListeners(game) {
            if(game === 'classic') {
                document.getElementById('submitBtn').addEventListener('click', () => {
                    let input = document.getElementById('gameInput');
                    let value = parseInt(input.value);
                    if(!value) return;
                    
                    let state = gameStates.classic;
                    state.attempts++;
                    
                    if(value === state.secret) {
                        // –ü–æ–±–µ–¥–∞
                        totalScore += 20;
                        gamesPlayed++;
                        wins++;
                        state.level++;
                        state.secret = Math.floor(Math.random() * (state.max - state.min + 1)) + state.min;
                        state.attempts = 0;
                        document.getElementById('gameHint').innerText = 'üéâ –ü–æ–±–µ–¥–∞!';
                        updateGlobalStats();
                    } else {
                        // –ü–æ–¥—Å–∫–∞–∑–∫–∞
                        let hint = value < state.secret ? 'üëâ –ë–æ–ª—å—à–µ' : 'üëà –ú–µ–Ω—å—à–µ';
                        document.getElementById('gameHint').innerText = hint;
                    }
                    
                    if(state.attempts >= state.maxAttempts) {
                        state.secret = Math.floor(Math.random() * (state.max - state.min + 1)) + state.min;
                        state.attempts = 0;
                        document.getElementById('gameHint').innerText = 'üîÑ –ù–æ–≤–æ–µ —á–∏—Å–ª–æ';
                    }
                    
                    input.value = '';
                    loadGame('classic');
                });
            }
            
            if(game === 'ranges') {
                // –í—ã–±–æ—Ä –¥–∏–∞–ø–∞–∑–æ–Ω–∞
                document.querySelectorAll('.mini-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        let min = parseInt(card.dataset.min);
                        let max = parseInt(card.dataset.max);
                        gameStates.ranges.min = min;
                        gameStates.ranges.max = max;
                        gameStates.ranges.secret = Math.floor(Math.random() * (max - min + 1)) + min;
                        document.getElementById('rangeHint').innerText = `${min}-${max}`;
                        document.getElementById('gameHint').innerText = 'üé≤ –ß–∏—Å–ª–æ –∑–∞–≥–∞–¥–∞–Ω–æ!';
                    });
                });
                
                document.getElementById('submitBtn').addEventListener('click', () => {
                    let input = document.getElementById('gameInput');
                    let value = parseInt(input.value);
                    if(!value || !gameStates.ranges.secret) return;
                    
                    if(value === gameStates.ranges.secret) {
                        totalScore += 30;
                        gamesPlayed++;
                        wins++;
                        document.getElementById('gameHint').innerText = 'üéâ –£–≥–∞–¥–∞–ª! +30';
                        gameStates.ranges.secret = null;
                        updateGlobalStats();
                    } else {
                        let hint = value < gameStates.ranges.secret ? 'üëâ –ë–æ–ª—å—à–µ' : 'üëà –ú–µ–Ω—å—à–µ';
                        document.getElementById('gameHint').innerText = hint;
                    }
                    input.value = '';
                });
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é –∏–≥—Ä—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        loadGame('classic');
        updateGlobalStats();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö —á–∏—Å–µ–ª
        gameStates.classic.secret = Math.floor(Math.random() * 100) + 1;
        gameStates.ranges.secret = Math.floor(Math.random() * 100) + 1;
        gameStates.time.secret = Math.floor(Math.random() * 200) + 1;
        gameStates.math.secret = Math.floor(Math.random() * 50) + 1;
    </script>
</body>
</html>
